{% extends 'base.html' %}
{% block content %}
<!-- Filters + Actions -->
<div class="toolbar">
    <div class="toolbar-left">
        <div class="field-group">
            <label for="search-asset">Search assets</label>
            <input id="search-asset" type="text" placeholder="Search by name, code, or location" />
        </div>
        <div class="field-group">
            <label for="filter-status">Status</label>
            <select id="filter-status">
                <option value="">All</option>
                <option value="Active">Active</option>
                <option value="In repair">In repair</option>
                <option value="Retired">Retired</option>
            </select>
        </div>
        <div class="field-group">
            <label for="filter-location">Location</label>
            <select id="filter-location">
                <option value="">All</option>
                {% for w in warehouses %}
                <option value="{{ w.warehouse_name }}">{{ w.warehouse_name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="toolbar-right">
        <!-- ✅ Export يطبع فقط Asset List -->
        <button class="btn-secondary" onclick="exportAssets()">Export</button>
        <!-- ينزل للفورم أسفل الصفحة -->
        <button class="btn-primary" onclick="scrollToAddAsset()">+ Add asset</button>
    </div>
</div>

<!-- ✅ حطينا class فقط: assets-print-area (بدون تغيير تصميم) -->
<div class="panel table-panel assets-print-area">
    <div class="panel-header">
        <div class="panel-title">Asset List</div>
        <div class="panel-subtitle">All registered company assets</div>
    </div>
    <div class="panel-body table-wrapper">
        <table class="data-table" id="assets-table">
            <thead>
                <tr>
                    <th>Asset Code</th>
                    <th>Asset Name</th>
                    <th>Location</th>
                    <th>Status</th>
                    <th class="no-print">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for a in assets %}
                <tr>
                    <td>{{ a.code }}</td>
                    <td>{{ a.name }}</td>
                    <td>{{ a.location|default:"-" }}</td>
                    <td><span class="badge">{{ a.get_status_display }}</span></td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="small-text">No assets yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Add New Asset Form (same page) -->
<div class="panel no-print" id="add-asset-panel" style="margin-top: 1.5rem;">
    <div class="panel-header">
        <div class="panel-title">Add New Asset</div>
        <div class="panel-subtitle">Add a new asset directly to the list below</div>
    </div>
    <div class="panel-body">
        <form method="post">{% csrf_token %}
            <div class="form-grid-3">
                <div class="field-group">
                    <label for="asset-code">Asset Code</label>
                    <input id="asset-code" name="code" type="text"
                        placeholder="e.g. AST-0006 (Verify auto-generation)" />
                </div>

                <div class="field-group">
                    <label for="asset-name">Asset Name</label>
                    <input id="asset-name" name="name" type="text" placeholder="e.g. Toyota Hilux #7" required />
                </div>

                <div class="field-group">
                    <label for="asset-location">Location</label>
                    <select id="asset-location" name="location">
                        <option value="">Select location...</option>
                        {% for w in warehouses %}
                        <option value="{{ w.pk }}">{{ w.warehouse_name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="field-group">
                    <label for="asset-status">Status</label>
                    <select id="asset-status" name="status">
                        <option value="ACTIVE">Active</option> <!-- Fixed values to match model default -->
                        <option value="IN_REPAIR">In repair</option>
                        <option value="RETIRED">Retired</option>
                    </select>
                </div>

                <div class="field-group">
                    <label for="asset-notes">Notes</label>
                    <input id="asset-notes" name="notes" type="text" placeholder="Additional info..." />
                </div>

                <div class="field-group">
                    <label>&nbsp;</label>
                    <button class="btn-primary full-width" type="submit">+ Add to Asset List</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Print footer (visible only in print) -->
<div id="print-footer" style="
                text-align: center;
                font-size: 0.75rem;
                color: #6b7280;
                margin-top: 2rem;
                display: none;
            ">
    طبعت بواسطة: <span id="printedBy"></span>
</div>
{% endblock %}